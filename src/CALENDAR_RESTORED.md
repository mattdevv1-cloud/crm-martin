# Восстановление календаря доставок для курьеров

## Что было сделано

Восстановлен календарный вид доставок для курьеров с возможностью переключения между списком и календарем.

## Основные изменения

### 1. Компонент Orders.tsx
- ✅ Добавлен переключатель между режимами отображения: **Список** и **Календарь**
- ✅ Календарный вид показывает заказы на неделю в формате сетки
- ✅ Сохранение выбранного режима в localStorage
- ✅ Поддержка навигации по неделям (← Сегодня →)
- ✅ Информационный баннер при отсутствии заказов

### 2. Система прав доступа (roles.ts)
- ✅ Восстановлено право `canViewCalendar: true` для роли `courier`
- ✅ Курьеры теперь могут видеть вкладку "Календарь" в навигации

### 3. Маршрутизация (App.tsx)
- ✅ При переходе на страницу "Календарь" курьер видит Orders с календарным видом
- ✅ Менеджеры и другие роли видят стандартный CalendarView

## Как это работает

### Для курьера:

#### Мобильная версия
1. **Вкладка "Доставки"** → Orders в режиме списка (сгруппировано по времени)
2. **Вкладка "Календарь"** → Orders в режиме календаря (сетка на неделю)
3. Переключение между режимами кнопками в шапке (иконки списка и календаря)

#### Десктопная версия
1. **Меню "Мои доставки"** → Orders в режиме списка
2. **Меню "Календарь"** → Orders в режиме календаря
3. Переключение между режимами доступно всегда

### Для других ролей:
- Страница "Календарь" показывает полный CalendarView со всеми заказами и фильтрами по распределению

## Особенности календарного вида

### Навигация
- Кнопки **←** и **→** для перехода на предыдущую/следующую неделю
- Кнопка **"Сегодня"** для быстрого возврата к текущей неделе
- Отображение диапазона дат недели

### Отображение заказов
- Каждый день недели показан отдельным столбцом (на десктопе)
- Текущий день выделен синим цветом
- Для каждого заказа показано:
  - Номер заказа
  - Статус доставки
  - Время доставки
  - Имя клиента
  - Адрес (с ограничением в 2 строки)
  - Сумма заказа

### Адаптивность
- На мобильных устройствах дни недели отображаются списком
- На десктопе - сетка 7 колонок (понедельник - воскресенье)
- Минимальная высота колонки 300px на десктопе

## Сохранение состояния
- Выбранный режим отображения (список/календарь) сохраняется в localStorage
- При следующем входе курьер увидит последний выбранный режим
- При переходе со страницы "Календарь" принудительно устанавливается календарный вид

## Технические детали

### Новые состояния в Orders.tsx
```typescript
const [courierViewMode, setCourierViewMode] = useState<'list' | 'calendar'>('list');
const [selectedDate, setSelectedDate] = useState(new Date());
```

### Новые функции
- `getWeekDates(date)` - получение массива дат недели
- `getOrdersForDate(date)` - фильтрация заказов по дате
- `goToPreviousWeek()` - переход на предыдущую неделю
- `goToNextWeek()` - переход на следующую неделю
- `goToToday()` - возврат к текущей неделе

### Props компонента Orders
```typescript
interface OrdersProps {
  onViewOrder?: (orderId: number) => void;
  onCreateOrder?: () => void;
  initialViewMode?: 'list' | 'calendar'; // новый prop
}
```

## UX улучшения
- ✅ Иконки для переключения режимов (список/календарь)
- ✅ Активное состояние переключателя
- ✅ Тактильная обратная связь на мобильных (active:scale-[0.98])
- ✅ Информативный баннер при отсутствии заказов
- ✅ Минимальные размеры кнопок 44x44px для удобства на мобильных

## Совместимость
- ✅ Полностью совместимо с существующей функциональностью
- ✅ Работает с OfflineQueue для офлайн-режима
- ✅ Интегрировано с CourierBottomSheet для деталей заказа
- ✅ Сохранена вся логика фильтрации заказов для курьеров
